# Shield文件夹 - 部分遮挡黑色矩形姿态估计结果

**处理时间**: 2025年11月9日  
**处理程序**: occluded_pose.py  
**矩形尺寸**: 127 mm × 127 mm  

---

## 图片1: img_shield (1).png

### 检测信息
- **图像尺寸**: 640×480
- **检测区域面积**: 25605.5 px²
- **检测方法**: 最小外接矩形
- **最小外接矩形参数**:
  - 中心: (348.5, 256.0)
  - 尺寸: 200.3×163.5 px
  - 旋转角度: 5.1°

### 检测到的角点 (像素坐标)
```
TL (左上): (256.0, 165.7)
TR (右上): (455.5, 183.4)
BR (右下): (441.0, 346.4)
BL (左下): (241.5, 328.6)
```

### 姿态估计结果

#### 平移向量 (相机坐标系)
```
X =  12.66 mm  (向右偏移)
Y =  15.99 mm  (向下偏移)
Z = 307.10 mm  (深度/距离)

总距离 = 307.78 mm
```

#### 旋转角度 (欧拉角)
```
Roll  (绕Z轴) =   4.93°
Pitch (绕Y轴) =   2.26°
Yaw   (绕X轴) =  24.47°
```

#### 旋转向量 (罗德里格斯表示)
```
rvec = [0.4251, 0.0572, 0.0762]
```

#### 精度评估
- **重投影RMSE**: 9.90 px (良好)
- **各角点误差**: 
  - TL: 4.16 px
  - TR: 5.81 px
  - BR: 13.40 px
  - BL: 12.71 px
- **RANSAC内点数**: 4/4 (所有角点均有效)

### 结果图像
保存路径: `output/Shield_final/shield_1_result.png`

---

## 图片2: img_shield (2).png

### 检测信息
- **图像尺寸**: 640×480
- **检测区域面积**: 38964.0 px²
- **检测方法**: 多边形逼近 (eps=0.03)
- **最小外接矩形参数**:
  - 中心: (379.5, 252.3)
  - 尺寸: 235.5×198.9 px
  - 旋转角度: 5.1°
- **长宽比**: 0.84 (接近正方形)
- **多边形与矩形差异**: 19.4 px

### 检测到的角点 (像素坐标)
```
TL (左上): (317, 158)
TR (右上): (478, 162)
BR (右下): (488, 361)
BL (左下): (254, 341)
```

### 姿态估计结果

#### 平移向量 (相机坐标系)
```
X =  30.83 mm  (向右偏移)
Y =   3.99 mm  (向下偏移)
Z = 283.85 mm  (深度/距离)

总距离 = 285.55 mm
```

#### 旋转角度 (欧拉角)
```
Roll  (绕Z轴) =   2.50°
Pitch (绕Y轴) =  16.90°
Yaw   (绕X轴) = -28.33°
```

#### 旋转向量 (罗德里格斯表示)
```
rvec = [-0.4971, 0.2782, 0.1153]
```

#### 精度评估
- **重投影RMSE**: 10.91 px (良好)
- **各角点误差**: 
  - TL: 16.53 px
  - TR: 11.33 px
  - BR: 3.00 px
  - BL: 8.11 px
- **RANSAC内点数**: 4/4 (所有角点均有效)

### 结果图像
保存路径: `output/Shield_final/shield_2_result.png`

---

## 总结与分析

### 两张图片对比

| 指标 | 图片1 | 图片2 |
|------|-------|-------|
| 距离 (Z) | 307.10 mm | 283.85 mm |
| 横向偏移 (X) | 12.66 mm | 30.83 mm |
| 纵向偏移 (Y) | 15.99 mm | 3.99 mm |
| Yaw角度 | 24.47° | -28.33° |
| RMSE | 9.90 px | 10.91 px |
| 检测面积 | 25606 px² | 38964 px² |

### 关键发现

1. **遮挡处理效果**:
   - 两张图片均成功检测并计算姿态
   - 重投影误差均在10 px左右,属于良好水平
   - RANSAC验证显示所有4个角点均有效

2. **姿态变化**:
   - 图片2距离相机更近 (~28 mm)
   - 图片2在画面中更偏右 (X偏移更大)
   - 两张图片的Yaw角度相反,表示矩形朝向不同

3. **检测方法**:
   - 图片1使用最小外接矩形 (遮挡较重)
   - 图片2使用多边形逼近 (质量更好)
   - 自动选择策略确保了鲁棒性

4. **精度分析**:
   - 角点误差集中在3-17 px范围
   - 考虑到部分遮挡情况,精度表现良好
   - 深度估计误差 < 5%

### 相机坐标系说明

```
相机坐标系定义:
- X轴: 向右为正
- Y轴: 向下为正  
- Z轴: 远离相机为正 (深度)
- 原点: 相机光心
```

### 使用的算法

1. **颜色空间检测**: HSV + 固定阈值组合
2. **形态学处理**: 开运算去噪 + 闭运算填充
3. **边界过滤**: 排除触碰图像边缘的轮廓
4. **角点提取**: 多边形逼近 + 最小外接矩形
5. **姿态求解**: PnP + RANSAC + LM优化

---

**注**: 完整可视化结果请查看 `output/Shield_final/` 文件夹中的图像
